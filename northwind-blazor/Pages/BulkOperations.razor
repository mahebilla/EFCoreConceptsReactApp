@page "/bulk-operations"

<DemoSection
    Title="Bulk Operations (EF Core 7+)"
    Subtitle="Demonstrates ExecuteUpdate and ExecuteDelete — set-based operations that bypass the change tracker."
    Demos="demos" />

@code {
    private List<EndpointDemo> demos = new()
    {
        new("ExecuteUpdate (Bulk Update)", "/api/bulkoperations/executeupdate", "POST",
            @"// POST /api/bulkoperations/executeupdate
var rowsAffected = await _context.Products
    .Where(p => p.CategoryId == 1)
    .ExecuteUpdateAsync(setters => setters
        .SetProperty(p => p.UnitPrice, p => p.UnitPrice * 1.10m)
    );

// Generates:
// UPDATE Products SET UnitPrice = UnitPrice * 1.10
// WHERE CategoryID = 1
//
// No entities are loaded into memory.",
            "Update all matching rows in a single SQL UPDATE — bypasses the change tracker entirely"),

        new("ExecuteDelete (Bulk Delete)", "/api/bulkoperations/executedelete", "POST",
            @"// POST /api/bulkoperations/executedelete
var rowsAffected = await _context.Products
    .Where(p => p.Discontinued && p.UnitsInStock == 0)
    .ExecuteDeleteAsync();

// Generates:
// DELETE FROM Products
// WHERE Discontinued = 1 AND UnitsInStock = 0
//
// Much faster than loading + Remove() + SaveChanges().",
            "Delete all matching rows in a single SQL DELETE — no entity loading needed"),

        new("ExecuteUpdate Multiple Properties", "/api/bulkoperations/executeupdate-multiple", "POST",
            @"// POST /api/bulkoperations/executeupdate-multiple
var rowsAffected = await _context.Products
    .Where(p => p.CategoryId == 2)
    .ExecuteUpdateAsync(setters => setters
        .SetProperty(p => p.UnitPrice, p => p.UnitPrice * 1.05m)
        .SetProperty(p => p.Discontinued, false)
        .SetProperty(p => p.ReorderLevel, (short)10)
    );

// All three columns updated in a single UPDATE statement.
// Chain multiple SetProperty calls for each column.",
            "Update multiple columns in a single bulk operation using chained SetProperty calls"),
    };
}
